<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IntelliFlow - New Ticket</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    fontFamily: { display: ["Inter", "sans-serif"] }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-900 text-white font-display">
    <div class="min-h-screen p-8 flex items-center justify-center">
        <div class="w-full max-w-2xl">
            <!-- Header -->
            <div class="mb-8 text-center">
                <h1 class="text-3xl font-bold mb-2">Create New Ticket</h1>
                <p class="text-slate-400">Describe the issue and let our AI agents handle the rest.</p>
            </div>

            <!-- Form -->
            <div class="bg-slate-800 rounded-xl border border-slate-700 p-8 shadow-2xl">
                <form id="createForm" class="space-y-6">
                    <!-- Title -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Issue Title</label>
                        <input type="text" id="title" required
                            class="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="e.g., Server requires restart">
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Detailed Description</label>
                        <textarea id="description" required rows="5"
                            class="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                            placeholder="Provide as much detail as possible..."></textarea>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <!-- Priority -->
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Priority</label>
                            <select id="priority"
                                class="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                                <option value="Medium">Auto-detect (AI)</option>
                                <option value="Low">Low</option>
                                <option value="Medium">Medium</option>
                                <option value="High">High</option>
                            </select>
                        </div>

                        <!-- Category -->
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Category</label>
                            <select id="category"
                                class="w-full bg-slate-900/50 border border-slate-600 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all">
                                <option value="">Auto-detect (AI)</option>
                                <option value="Technical">Technical</option>
                                <option value="Billing">Billing</option>
                                <option value="Access">Access</option>
                            </select>
                        </div>
                    </div>

                    <!-- AI Info Badge -->
                    <div class="flex items-center gap-3 bg-blue-500/10 border border-blue-500/20 rounded-lg p-4">
                        <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center shrink-0">
                            <span class="material-symbols-outlined text-blue-400 text-sm">psychology</span>
                        </div>
                        <p class="text-xs text-blue-200">
                            <strong>AI Enabled:</strong> Our agents will automatically analyze the priority, category,
                            and risk level of this ticket immediately upon creation.
                        </p>
                    </div>

                    <!-- Buttons -->
                    <div class="flex gap-4 pt-2">
                        <button type="button"
                            onclick="window.location.href='http://127.0.0.1:8000/static/dashboard.html'"
                            class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-medium transition-colors">
                            Cancel
                        </button>
                        <button type="submit" id="submitBtn"
                            class="flex-1 px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold shadow-lg shadow-blue-900/50 transition-all flex items-center justify-center gap-2">
                            <span>Create Ticket</span>
                            <span class="material-symbols-outlined text-sm">arrow_forward</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('createForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerHTML;

            // Loading state
            btn.disabled = true;
            btn.innerHTML = '<div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> Creating...';

            // Get values
            const formValues = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                priority: document.getElementById('priority').value,
                status: 'New'
            };

            // Add category if manually selected
            const cat = document.getElementById('category').value;
            if (cat) formValues.category = cat;

            try {
                const res = await fetch('/tickets', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formValues)
                });

                if (res.ok) {
                    const data = await res.json();
                    window.location.href = `/static/detail.html?id=${data.id}`;
                } else {
                    alert('Error creating ticket');
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }
            } catch (e) {
                console.error(e);
                alert('Connection error');
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        });
    </script>
</body>

</html>